From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Ryan Volz <ryan.volz@gmail.com>
Date: Thu, 13 Jul 2023 17:13:09 -0400
Subject: [PATCH] cmake: Manually specify compiled-in GNSSSDR_INSTALL_DIR.

Signed-off-by: Ryan Volz <ryan.volz@gmail.com>
---
 CMakeLists.txt                                       | 3 +++
 src/algorithms/libs/CMakeLists.txt                   | 4 ++--
 src/algorithms/signal_source/adapters/CMakeLists.txt | 2 +-
 utils/front-end-cal/CMakeLists.txt                   | 2 +-
 4 files changed, 7 insertions(+), 4 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 839744f3a..8c1eb5f6e 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -226,6 +226,9 @@ if(NOT CMAKE_PREFIX_PATH)
     endif()
 endif()
 
+# Set compiled-in install dir, cache so it can be overridden
+set(GNSSSDR_INSTALL_DIR_DEF ${CMAKE_INSTALL_PREFIX} CACHE STRING "Compiled-in install dir definition")
+
 # Detect Linux Distribution
 if(${CMAKE_SYSTEM_NAME} MATCHES "Linux|kFreeBSD|GNU")
     include(DetectLinuxDistro)
diff --git a/src/algorithms/libs/CMakeLists.txt b/src/algorithms/libs/CMakeLists.txt
index 3f0b050a6..3e87e28bf 100644
--- a/src/algorithms/libs/CMakeLists.txt
+++ b/src/algorithms/libs/CMakeLists.txt
@@ -165,7 +165,7 @@ target_include_directories(algorithms_libs
 )
 
 target_compile_definitions(algorithms_libs
-    PUBLIC -DGNSSSDR_INSTALL_DIR="${CMAKE_INSTALL_PREFIX}"
+    PUBLIC -DGNSSSDR_INSTALL_DIR="${GNSSSDR_INSTALL_DIR_DEF}"
 )
 
 if(DO_NOT_USE_LAMBDAS)
@@ -224,7 +224,7 @@ else()
 endif()
 
 target_compile_definitions(gnss_sdr_flags
-    PRIVATE -DGNSSSDR_INSTALL_DIR="${CMAKE_INSTALL_PREFIX}"
+    PRIVATE -DGNSSSDR_INSTALL_DIR="${GNSSSDR_INSTALL_DIR_DEF}"
 )
 
 if(ENABLE_CLANG_TIDY)
diff --git a/src/algorithms/signal_source/adapters/CMakeLists.txt b/src/algorithms/signal_source/adapters/CMakeLists.txt
index 48e18e5f3..1cf7887a9 100644
--- a/src/algorithms/signal_source/adapters/CMakeLists.txt
+++ b/src/algorithms/signal_source/adapters/CMakeLists.txt
@@ -332,7 +332,7 @@ if(ENABLE_CLANG_TIDY)
 endif()
 
 target_compile_definitions(signal_source_adapters
-    PRIVATE -DGNSSSDR_INSTALL_DIR="${CMAKE_INSTALL_PREFIX}"
+    PRIVATE -DGNSSSDR_INSTALL_DIR="${GNSSSDR_INSTALL_DIR_DEF}"
 )
 
 set_property(TARGET signal_source_adapters
diff --git a/utils/front-end-cal/CMakeLists.txt b/utils/front-end-cal/CMakeLists.txt
index 1dd300b1f..3d6bfaa26 100644
--- a/utils/front-end-cal/CMakeLists.txt
+++ b/utils/front-end-cal/CMakeLists.txt
@@ -81,7 +81,7 @@ endif()
 
 target_compile_definitions(front-end-cal
     PRIVATE -DGNSS_SDR_VERSION="${VERSION}"
-    PRIVATE -DGNSSSDR_INSTALL_DIR="${CMAKE_INSTALL_PREFIX}"
+    PRIVATE -DGNSSSDR_INSTALL_DIR="${GNSSSDR_INSTALL_DIR_DEF}"
 )
 
 if(USE_GENERIC_LAMBDAS)
-- 
2.51.0

